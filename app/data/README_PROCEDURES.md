# Test Question Loading Procedure

This document defines how we add or update tests from pasted study material. You can say: "Follow the Test Question Loading Procedure to create/update category X/subcategory Y from the following content." I will extract questions, answers, and explanations, then format JSON and update counts.

## Directory Structure

- `categories/<Category>/<Subcategory>/questions.json`
- `data/index.json` (auto-generated by `tools/scan.js`)

Examples:
- `categories/Computer Science/Network Protocols/questions.json`
- `categories/Finance/Accounting Basics/questions.json`

## Question JSON Schema

Each `questions.json` contains an array of question objects:

```json
[
  {
    "id": "q-unique-id",
    "question": "Question text here",
    "choices": ["A", "B", "C", "D"],
    "answerIndex": 1,
    "explanation": "Optional explanation.",
    "difficulty": "easy"
  }
]
```

- `id` should be stable and unique within the subcategory. Use a short slug or incremental id.
- `choices` is an array of strings (2+ options). Multiple choice only.
- `answerIndex` is the 0-based index into `choices` representing the correct answer.
- `explanation` is optional; include when available.
- `difficulty` is optional; accepted values: `easy`, `medium`, `hard`.

## Creating a New Category/Subcategory

1. Create directory: `categories/<Category>/<Subcategory>/`
2. Create or overwrite `questions.json` with extracted questions in the schema above.
3. Run:
   ```bash
   node tools/scan.js
   ```
4. Verify `data/index.json` reflects the new counts.

## Updating an Existing Subcategory

1. Read existing `questions.json`.
2. Append new questions at the end (preserve existing IDs; ensure new IDs are unique).
3. Keep consistent formatting; avoid duplicates.
4. Run `node tools/scan.js` to refresh counts.

## Scanner Behavior (`tools/scan.js`)

- Recursively scans `categories/` for any `questions.json` at `<Category>/<Subcategory>/questions.json`.
- Counts valid questions and writes `data/index.json` with the structure:

```json
{
  "categories": {
    "Category": {
      "Subcategory": { "count": 12 }
    }
  },
  "generatedAt": "2025-10-30T00:00:00.000Z"
}
```

- Invalid files are ignored with a warning (missing array, missing fields, or malformed JSON).

## Frontend Expectations

- The UI loads `data/index.json` to list categories and subcategories with counts.
- When a user selects a subcategory, the UI loads that subcategory's `questions.json` and shows:
  - Progress bar (number of questions known from index and current position)
  - Running score (correct/incorrect and percentage so far)
  - Immediate feedback with optional explanation

## Example Command Summary

- Regenerate index: `node app/tools/scan.js`
- Start local server: `node app/server.js` then open `http://localhost:8080`

## Notes

- Keep naming consistent. Capitalization in directory names is used as displayed labels.
- If you provide raw study text, I will derive Q/A/choices/explanations and produce the JSON for you.

## Post-processing Cleanup

After I complete importing or generating questions and refresh the index:

- I will clear the `Category`, `Subcategory`, and the pasted content block in `INTAKE_TEMPLATE.md` (or the copied intake file you provided) so itâ€™s clean for the next run.
- I will leave your constraints/checklist structure intact.
